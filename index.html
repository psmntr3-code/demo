<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Project Pembangunan Ruang Sekolah Minggu</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{ --glass:rgba(255,255,255,.7); --ring:rgba(15,23,42,.06);}
    body{ font-family:"Plus Jakarta Sans",system-ui,ui-sans-serif; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-rose-50 via-indigo-50 to-emerald-50 text-slate-800">

<div class="absolute inset-0 pointer-events-none">
  <div class="absolute -top-24 -right-16 w-72 h-72 rounded-full bg-rose-200/40 blur-3xl"></div>
  <div class="absolute -bottom-24 -left-16 w-80 h-80 rounded-full bg-emerald-200/40 blur-3xl"></div>
</div>

<header class="relative max-w-6xl mx-auto p-6">
  <div class="rounded-3xl px-6 py-5 bg-gradient-to-r from-indigo-200/60 via-sky-200/60 to-emerald-200/60 ring-1" style="--tw-ring-color: var(--ring);">
    <h1 class="text-2xl md:text-3xl font-bold">Project Pembangunan Ruang Sekolah Minggu</h1>
    <p class="text-sm text-slate-600 mt-1">Status real-time</p>
  </div>
</header>

<main class="relative max-w-6xl mx-auto p-6 grid gap-6">

  <!-- RINGKASAN -->
  <section class="grid grid-cols-1 md:grid-cols-4 gap-4">
    <div class="card"><div class="text-xs text-slate-500">Dana Diperlukan</div><div id="danaTotal" class="text-xl font-semibold">...</div></div>
    <div class="card"><div class="text-xs text-slate-500">Dana Terkumpul</div><div id="totalMasuk" class="text-xl font-semibold">...</div></div>
    <div class="card"><div class="text-xs text-slate-500">Kekurangan</div><div id="kekurangan" class="text-xl font-semibold">...</div></div>
    <div class="card"><div class="text-xs text-slate-500">Target Pertama</div><div id="targetPertama" class="text-xl font-semibold">...</div></div>
  </section>

  <script>
    const DB_URL = "https://datatransfer-eb687-default-rtdb.asia-southeast1.firebasedatabase.app/"; 
    const bulanIndo = ["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];

    function dec64(s){ return atob(s); }
    function rupiah(n){ return "Rp " + Number(n).toLocaleString("id-ID"); }

    async function loadData(){
      const meta = await fetch(DB_URL + "/GBISMB34-19C7-4793-B72A-063F232F4C41.json").then(r=>r.json());
      const monthly = await fetch(DB_URL + "/GBISMB34-19C7-4793-B72A-063F232F4C41/totals/monthly.json").then(r=>r.json());

      const danaTotal = meta?.danaDiperlukan ? Number(dec64(meta.danaDiperlukan)) : 0;
      const target = meta?.targetPertama ? Number(dec64(meta.targetPertama)) : 0;

      let totalMasuk = 0;
      let listBulan = [];

      if(monthly){
        for(const k in monthly){
          const [y,m] = k.split("-"); 
          const pir = monthly[k].PIR ? Number(dec64(monthly[k].PIR)) : 0;
          const trf = monthly[k].Transfer ? Number(dec64(monthly[k].Transfer)) : 0;
          const subtotal = pir + trf;
          totalMasuk += subtotal;
          listBulan.push({ label:`${bulanIndo[Number(m)-1]} ${y}`, pir, trf, subtotal });
        }
      }

      document.getElementById("danaTotal").innerText = rupiah(danaTotal);
      document.getElementById("totalMasuk").innerText = rupiah(totalMasuk);
      document.getElementById("kekurangan").innerText = rupiah(danaTotal - totalMasuk);
      document.getElementById("targetPertama").innerText = rupiah(target);

      const tbody = document.getElementById("listBulanan");
      tbody.innerHTML = "";
      listBulan.forEach(r=>{
        tbody.innerHTML += `
          <tr class="border-b border-slate-200/50">
            <td class="py-2">${r.label}</td>
            <td class="py-2">${rupiah(r.pir)}</td>
            <td class="py-2">${rupiah(r.trf)}</td>
            <td class="py-2 font-semibold">${rupiah(r.subtotal)}</td>
          </tr>
        `;
      });
    }

    document.addEventListener("DOMContentLoaded", loadData);
  </script>

  <style>
    .card {border-radius:1rem;padding:1rem;background:var(--glass);backdrop-filter:blur(8px);border:1px solid var(--ring);}
  </style>

  <!-- DAFTAR BULANAN -->
  <section class="rounded-3xl p-5 bg-[var(--glass)] backdrop-blur ring-1" style="--tw-ring-color:var(--ring);">
    <h2 class="font-semibold mb-3">Rincian Bulanan</h2>
    <table class="min-w-full text-sm">
      <thead class="text-slate-600">
        <tr><th class="text-left py-2">Bulan</th><th class="text-left py-2">PIR</th><th class="text-left py-2">Transfer</th><th class="text-left py-2">Total</th></tr>
      </thead>
      <tbody id="listBulanan"></tbody>
    </table>
  </section>

  <!-- TOMBOL DONASI -->
  <button onclick="openModal()" class="mt-4 mx-auto px-6 py-3 rounded-xl bg-indigo-400 hover:bg-indigo-300 text-slate-800 font-semibold transition">Donasi</button>

</main>

<footer class="relative max-w-6xl mx-auto p-6 text-xs text-slate-500">© 2025 — Penggalangan Dana</footer>

<!-- MODAL -->
<div id="modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center">
  <div class="bg-white rounded-2xl p-6 max-w-md w-full text-center shadow-xl">
    <h3 class="text-lg font-bold mb-3">Informasi Donasi</h3>
    <p class="text-sm text-slate-600 mb-3">Transfer dapat dilakukan ke rekening:</p>

    <div class="font-semibold text-lg mb-4">
      BCA 123456789 <br> a.n. GBI SM / Pembangunan Ruang
    </div>

    <p class="text-xs text-slate-600 mb-4">Setelah transfer, konfirmasi ke panitia.</p>

    <button onclick="closeModal()" class="mt-3 px-4 py-2 rounded-lg bg-slate-700 text-white hover:bg-slate-600">Tutup</button>
  </div>
</div>

<script>
function openModal(){ document.getElementById("modal").classList.remove("hidden"); document.getElementById("modal").classList.add("flex"); }
function closeModal(){ document.getElementById("modal").classList.add("hidden"); document.getElementById("modal").classList.remove("flex"); }
</script>

</body>
</html>
