<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<title>Perayaan Natal GBI Lembang 2025</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
  :root{
    --bg-red:#991b1b;
    --panel:#111827ee;
    --border:#4b5563;
    --text:#f9fafb;
    --muted:#9ca3af;
    --seat:#d1d5db;
    --seat-selected:#3b82f6;
    --screen:#e11d48;
  }

  *{box-sizing:border-box;margin:0;padding:0}

  body{
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    min-height:100vh;
    padding:16px;
    color:var(--text);
    background:
      radial-gradient(circle at center,
                      rgba(255,255,255,0.38) 0,
                      rgba(255,255,255,0.18) 12%,
                      rgba(255,255,255,0.0) 42%),
      conic-gradient(from 0turn at center,
                     rgba(255,255,255,0.20) 0deg 8deg,
                     transparent 8deg 23deg,
                     rgba(255,255,255,0.16) 23deg 31deg,
                     transparent 31deg 46deg,
                     rgba(255,255,255,0.18) 46deg 54deg,
                     transparent 54deg 69deg,
                     rgba(255,255,255,0.20) 69deg 77deg,
                     transparent 77deg 92deg,
                     rgba(255,255,255,0.16) 92deg 100deg,
                     transparent 100deg 115deg,
                     rgba(255,255,255,0.20) 115deg 123deg,
                     transparent 123deg 360deg),
      var(--bg-red);
  }

  .app{
    max-width:900px;
    margin:0 auto;
    background:var(--panel);
    border-radius:16px;
    box-shadow:0 18px 40px rgba(0,0,0,.45);
    padding:16px 16px 24px;
    position:relative;
    overflow:hidden;
  }

  .top-decor,
  .bottom-decor,
  .side-decor-left,
  .side-decor-right{
    position:absolute;
    pointer-events:none;
  }
  .top-decor{
    top:0;
    left:0;
    width:100%;
    transform:translateY(-40%);
  }
  .bottom-decor{
    left:0;
    bottom:-20px;
    width:100%;
    opacity:.6;
  }
  .side-decor-left{
    left:-10px;
    top:50%;
    transform:translateY(-50%);
    opacity:.7;
  }
  .side-decor-right{
    right:-10px;
    top:50%;
    transform:translateY(-50%);
    opacity:.7;
  }

  h1{
    font-size:22px;
    text-align:center;
    margin-bottom:4px;
    letter-spacing:.06em;
    text-transform:uppercase;
  }
  .subtitle{
    font-size:13px;
    color:var(--muted);
    margin-bottom:12px;
    text-align:center;
  }

  /* overlay input di atas layout kursi */
  #input-overlay{
    position:absolute;
    inset:0;
    background:rgba(15,23,42,0.80);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:10;
  }
  #input-section{
    padding:18px 20px;
    border-radius:14px;
    border:1px solid var(--border);
    background:#020617ee;
    display:flex;
    flex-direction:column;
    align-items:center;
    text-align:center;
    max-width:280px;
  }
  #input-section label{
    font-size:14px;
    display:block;
    margin-bottom:8px;
  }
  #seatInput{
    width:180px;
    padding:8px 10px;
    font-size:16px;
    border-radius:999px;
    border:1px solid var(--border);
    margin-right:8px;
    background:#020617;
    color:var(--text);
  }
  #assignBtn{
    padding:8px 16px;
    border-radius:999px;
    border:none;
    background:#22c55e;
    color:#022c22;
    font-size:14px;
    cursor:pointer;
    margin-top:8px;
  }
  #assignBtn:hover{opacity:.95;}

  /* layout kursi */
  #layout-section{
    margin-top:10px;
  }

  .screen{
    margin:14px auto 16px;
    width:80%;
    height:50px;
    border-radius:999px;
    background:var(--screen);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:13px;
    letter-spacing:.18em;
    text-transform:uppercase;
    color:#f9fafb;
  }

  .legend{
    display:flex;
    justify-content:center;
    gap:10px;
    font-size:11px;
    margin-bottom:8px;
    color:var(--muted);
  }
  .legend span{
    display:inline-flex;
    align-items:center;
    gap:4px;
  }
  .legend-box{
    width:14px;
    height:14px;
    border-radius:4px;
    background:var(--seat-selected);
    border:1px solid var(--seat-selected);
  }

  .selected-info{
    font-size:18px;
    margin-bottom:6px;
    text-align:center;
  }
  .selected-info strong{
    font-size:22px;
  }

  .columns-header{
    display:flex;
    align-items:flex-end;
    justify-content:center;
    margin-left:0;
    margin-bottom:4px;
    font-size:11px;
    color:var(--muted);
  }
  .col-num{
    width:26px;
    text-align:center;
    margin-right:4px;
  }
  .col-num.col-gap{
    margin-right:18px;
  }

  #seat-container{
    display:flex;
    flex-direction:column;
    align-items:center;
  }

  .seat-row{
    display:flex;
    align-items:center;
    margin-bottom:4px;
  }
  .seat-row.row-gap{
    margin-bottom:18px;
  }

  .row-label{
    width:24px;
    text-align:center;
    font-size:13px;
    font-weight:600;
    margin-right:10px;
  }

  .seat{
    width:26px;
    height:26px;
    border-radius:6px;
    background:var(--seat);
    border:1px solid var(--border);
    font-size:10px;
    display:flex;
    align-items:center;
    justify-content:center;
    user-select:none;
    margin-right:4px;
    color:#111827;
    cursor:default;
  }
  .seat.col-gap{
    margin-right:18px;
  }
  .seat.selected{
    background:var(--seat-selected);
    border-color:var(--seat-selected);
    color:#fff;
  }

  @media (max-width:480px){
    body{padding:10px;}
    .app{padding:12px 10px 18px;}
    h1{font-size:18px;}
    .seat,
    .col-num{
      width:22px;
      height:22px;
      font-size:9px;
    }
    .col-num.col-gap{margin-right:12px;}
    .seat.col-gap{margin-right:12px;}
    .row-label{margin-right:6px;}
    .screen{
      width:90%;
      font-size:11px;
      letter-spacing:.12em;
    }
    #input-section{
      max-width:280px;
      width:90%;
    }
  }
</style>
</head>
<body>

<div class="app">
  <!-- dekor lampu natal atas -->
  <div class="top-decor">
    <svg width="100%" height="70" preserveAspectRatio="none">
      <defs>
        <linearGradient id="bulbRed" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#fecaca"/>
          <stop offset="100%" stop-color="#b91c1c"/>
        </linearGradient>
        <linearGradient id="bulbGreen" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#bbf7d0"/>
          <stop offset="100%" stop-color="#15803d"/>
        </linearGradient>
        <linearGradient id="bulbGold" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#fef9c3"/>
          <stop offset="100%" stop-color="#b45309"/>
        </linearGradient>
      </defs>
      <rect x="0" y="30" width="100%" height="1" fill="#e5e7eb"/>
      <line x1="10%" y1="0" x2="10%" y2="30" stroke="#e5e7eb" stroke-width="1"/>
      <line x1="30%" y1="0" x2="30%" y2="30" stroke="#e5e7eb" stroke-width="1"/>
      <line x1="50%" y1="0" x2="50%" y2="30" stroke="#e5e7eb" stroke-width="1"/>
      <line x1="70%" y1="0" x2="70%" y2="30" stroke="#e5e7eb" stroke-width="1"/>
      <line x1="90%" y1="0" x2="90%" y2="30" stroke="#e5e7eb" stroke-width="1"/>
      <circle cx="10%" cy="40" r="7" fill="url(#bulbRed)"/>
      <circle cx="30%" cy="40" r="7" fill="url(#bulbGreen)"/>
      <circle cx="50%" cy="40" r="7" fill="url(#bulbGold)"/>
      <circle cx="70%" cy="40" r="7" fill="url(#bulbRed)"/>
      <circle cx="90%" cy="40" r="7" fill="url(#bulbGreen)"/>
    </svg>
  </div>

  <!-- dekor samping -->
  <div class="side-decor-left">
    <svg width="70" height="140">
      <defs>
        <linearGradient id="ornRed" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#fecaca"/>
          <stop offset="100%" stop-color="#b91c1c"/>
        </linearGradient>
      </defs>
      <line x1="35" y1="0" x2="35" y2="20" stroke="#e5e7eb" stroke-width="1.2"/>
      <circle cx="35" cy="40" r="18" fill="url(#ornRed)" stroke="#fee2e2" stroke-width="2"/>
      <rect x="31" y="20" width="8" height="6" fill="#e5e7eb" rx="1"/>
      <path d="M24 40h22" stroke="#fee2e2" stroke-width="2" stroke-dasharray="3 3"/>
      <polygon points="12,90 15,97 22,97 16,101 18,108 12,104 6,108 8,101 2,97 9,97"
               fill="#facc15"/>
    </svg>
  </div>

  <div class="side-decor-right">
    <svg width="70" height="140">
      <defs>
        <linearGradient id="candy" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#fee2e2"/>
          <stop offset="50%" stop-color="#fecaca"/>
          <stop offset="100%" stop-color="#b91c1c"/>
        </linearGradient>
      </defs>
      <path d="M40 15
               a10 10 0 0 0 -20 0
               v70"
            fill="none" stroke="url(#candy)" stroke-width="8" stroke-linecap="round"/>
      <circle cx="20" cy="15" r="4" fill="#fee2e2"/>
      <polygon points="58,90 61,97 68,97 62,101 64,108 58,104 52,108 54,101 48,97 55,97"
               fill="#fde68a"/>
    </svg>
  </div>

  <h1>Perayaan Natal GBI Lembang 2025</h1>
  <div class="subtitle" id="subtitle">
    Scan tiket atau masukkan nomor kursi (misal: A1, B10, J20 atau A1-A4).
  </div>

  <!-- overlay input di atas layout -->
  <div id="input-overlay">
    <div id="input-section">
      <label for="seatInput">
        Masukan nomor kursi (contoh: A1)
      </label>
      <div>
        <input id="seatInput" type="text" autocomplete="off">
        <button id="assignBtn">Lanjut</button>
      </div>
    </div>
  </div>

  <!-- layout kursi selalu terlihat -->
  <div id="layout-section">
    <div class="selected-info">
      Kursi Anda: <strong id="selectedSeatLabel">-</strong>
    </div>
    <div class="legend">
      <span><span class="legend-box"></span> Duduk di sini</span>
    </div>

    <div class="screen">LAYAR / PANGGUNG</div>

    <div class="columns-header" id="columns-header"></div>
    <div id="seat-container"></div>
  </div>

  <!-- dekor bawah -->
  <div class="bottom-decor">
    <svg width="100%" height="70" preserveAspectRatio="none">
      <polygon points="15,60 35,25 55,60" fill="#16a34a"/>
      <polygon points="20,60 35,32 50,60" fill="#22c55e"/>
      <rect x="31" y="60" width="8" height="8" fill="#92400e"/>
      <circle cx="35" cy="24" r="3" fill="#fbbf24"/>
      <circle cx="27" cy="42" r="2" fill="#fb7185"/>
      <circle cx="44" cy="45" r="2" fill="#facc15"/>
      <circle cx="30" cy="53" r="2" fill="#38bdf8"/>
      <polygon points="90,50 94,60 104,60 96,66 99,76 90,70 81,76 84,66 76,60 86,60"
               fill="#eab308" transform="translate(-10,-10)"/>
    </svg>
  </div>
</div>

<script>
  const ROWS = 20;
  const COLS = 20;
  const GROUP_SIZE = 10;

  const inputOverlay    = document.getElementById('input-overlay');
  const seatContainer   = document.getElementById('seat-container');
  const columnsHeader   = document.getElementById('columns-header');
  const selectedLabelEl = document.getElementById('selectedSeatLabel');
  const subtitleEl      = document.getElementById('subtitle');

  function buildColumnHeader(){
    for(let c=0;c<COLS;c++){
      const col = document.createElement('div');
      col.className = 'col-num';
      if((c+1)%GROUP_SIZE===0 && (c+1)<COLS){
        col.classList.add('col-gap');
      }
      col.textContent = (c+1);
      columnsHeader.appendChild(col);
    }
  }

  function buildSeats(){
    const baseCharCode = 'A'.charCodeAt(0);
    for(let r=0;r<ROWS;r++){
      const rowDiv = document.createElement('div');
      rowDiv.className = 'seat-row';
      if((r+1)%GROUP_SIZE===0 && (r+1)<ROWS){
        rowDiv.classList.add('row-gap');
      }

      const rowLabelChar = String.fromCharCode(baseCharCode + r);
      const labelDiv = document.createElement('div');
      labelDiv.className = 'row-label';
      labelDiv.textContent = rowLabelChar;
      rowDiv.appendChild(labelDiv);

      for(let c=0;c<COLS;c++){
        const seat = document.createElement('div');
        seat.className = 'seat';
        if((c+1)%GROUP_SIZE===0 && (c+1)<COLS){
          seat.classList.add('col-gap');
        }
        const seatId = rowLabelChar + (c+1);
        seat.dataset.seatId = seatId;
        seat.textContent = c+1;
        rowDiv.appendChild(seat);
      }
      seatContainer.appendChild(rowDiv);
    }
  }

  function getSeatQueryRaw(){
    const params = new URLSearchParams(window.location.search);
    let q = params.get('q');
    if(!q) return null;
    return q.trim();
  }

  // Parse q string menjadi array seatId (A1, A2, ...)
  // Mendukung:
  //   - A1
  //   - A1-A4 (range di baris yang sama)
  //   - A1,A4,B2-B4 (kombinasi, dipisah koma)
  function parseSeatQuery(q){
    if(!q) return [];
    q = q.toUpperCase();
    const parts = q.split(',').map(p => p.trim()).filter(p => p.length>0);
    const seats = new Set();

    const singleRe = /^([A-Z])(\d+)$/;
    const rangeRe  = /^([A-Z])(\d+)-([A-Z])?(\d+)$/;

    for(const part of parts){
      let mRange = part.match(rangeRe);
      if(mRange){
        const row1 = mRange[1];
        const col1 = parseInt(mRange[2], 10);
        const row2 = mRange[3] ? mRange[3] : row1;
        const col2 = parseInt(mRange[4], 10);

        if(row1 === row2){
          const start = Math.min(col1, col2);
          const end   = Math.max(col1, col2);
          for(let c=start;c<=end;c++){
            seats.add(row1 + String(c));
          }
        }else{
          // jika beda row, anggap hanya 2 titik
          seats.add(row1 + String(col1));
          seats.add(row2 + String(col2));
        }
        continue;
      }

      let mSingle = part.match(singleRe);
      if(mSingle){
        const row = mSingle[1];
        const col = parseInt(mSingle[2], 10);
        seats.add(row + String(col));
      }
    }

    return Array.from(seats);
  }

  function applySeatSelection(seatIds){
    if(!seatIds || seatIds.length===0){
      selectedLabelEl.textContent = 'â€“ (tidak ada yang terbaca)';
      return;
    }

    // hapus pilihan lama (kalau ada)
    document.querySelectorAll('.seat.selected').forEach(el => el.classList.remove('selected'));

    // tandai semua seat yang valid
    let firstValid = null;
    seatIds.forEach(id => {
      const seatEl = document.querySelector('[data-seat-id="' + id + '"]');
      if(seatEl){
        seatEl.classList.add('selected');
        if(!firstValid) firstValid = id;
      }
    });

    if(firstValid){
      if(seatIds.length === 1){
        selectedLabelEl.textContent = firstValid;
      }else{
        selectedLabelEl.textContent = seatIds.join(', ');
      }
    }else{
      selectedLabelEl.textContent = seatIds.join(', ') + ' (tidak ditemukan di layout)';
    }
  }

  document.getElementById('assignBtn').addEventListener('click', function(){
    let seat = document.getElementById('seatInput').value || '';
    seat = seat.trim();
    // izinkan huruf, angka, koma, minus, dan spasi
    if(!/^[A-Z0-9,\-\s]+$/i.test(seat)){
      alert('Format nomor kursi tidak valid. Contoh: A1, A1-A4, A1,A4.');
      return;
    }
    // cek apakah parsing menghasilkan kursi
    const parsed = parseSeatQuery(seat);
    if(parsed.length === 0){
      alert('Tidak ada nomor kursi yang terbaca. Contoh: A1.');
      return;
    }
    const newUrl = window.location.pathname + '?q=' + encodeURIComponent(seat);
    window.location.href = newUrl;
  });

  // Inisialisasi layout
  buildColumnHeader();
  buildSeats();

  const seatQueryRaw = getSeatQueryRaw();
  if(seatQueryRaw){
    inputOverlay.style.display = 'none';
    if(subtitleEl) subtitleEl.style.display = 'none';
    const seatIds = parseSeatQuery(seatQueryRaw);
    applySeatSelection(seatIds);
  }else{
    inputOverlay.style.display = 'flex';
    if(subtitleEl) subtitleEl.style.display = 'block';
  }
</script>
</body>
</html>
